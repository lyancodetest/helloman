# 迁移流程
## 一、应用评估
#### 1、使用的表及数据量
主要是用于评估迁移后的mysql实例资源及否要分表分库
* 静态数据  
表存在多少行数据，占用多少空间
* 动态数据  
每天/每月的数据增长量
* 表结构测试环境与生产环境是否一致
	
#### 2、业务分析
** 可用性 **
* 可停机，最多停机时间  
可否直接停机使用全量迁移
* 读一直可用，写最多停机时间  
全量+增量形式是否满足，该方案最多停机多长
* 读写一直可用  
要如何实现，需要侵入应用代码？

** 流量 **
* dubbo
对哪此应用提供
* http
接供哪些接口服务
* rabbitmq
如果有消费者提前通知运维，不然会告警

#### 4、回滚方案
需要提供下回滚方案，是否能随时回退至旧版本，不行的话给个备用方案
#### 5、BI等下游
青鸾：修改同步数据的connector，保证pg增量同步topic+mysql增量同步topic不丢数据即可
BI：已经初步与BI团队沟通次，如果近期对接青鸾的话应该没什么影响
运营系统：之前有通过BI推送数据至kafka，后续统一下运营需要的实时数据

## 二、应用调整
#### 1、业务测试
重点在于sql兼容性，尽量能开发个工具分析所有sql
#### 2、性能测试
目前阶段：大于1000万需要性能测试
对于线上接口，查询时间控制在多长时间内全量(比如99%查询在200ms内，写在多少ms内)

## 三、数据迁移

#### 1、表结构迁移
[见dba文档](https://git.wolaidai.com/WelabCo/Architecture/work-profile/blob/master/data-migration/DBA-PG%E8%BF%81%E7%A7%BBMySQL%E9%A1%B9%E7%9B%AE%E5%85%A8%E9%87%8F%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%AE%9E%E6%96%BD%E6%89%8B%E5%86%8C.docx)
#### 2、全量数据迁移
[见dba文档](https://git.wolaidai.com/WelabCo/Architecture/work-profile/blob/master/data-migration/DBA-PG%E8%BF%81%E7%A7%BBMySQL%E9%A1%B9%E7%9B%AE%E5%85%A8%E9%87%8F%E6%95%B0%E6%8D%AE%E8%BF%81%E7%A7%BB%E5%AE%9E%E6%96%BD%E6%89%8B%E5%86%8C.docx)
#### 3、增量数据迁移
开发中
#### 4、数据自动化核对
开发中
## 四、应用切换
#### 1、应用升级
* 需要分几次升级，代码对应哪些分支，需要提前准备好  
* 如何验证，直接看日志还是要测试人员配合

#### 2、权限回收
rds