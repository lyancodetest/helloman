# hbase方案

## 一、现状
toc数据上报：使用hbase1.0版本，并目前运行稳定，将来该系统准备废弃，所以不用处理。
青鸾：使用hbase2.0版本
留痕重构：实时应用，目前500G，预计一年后800G，写多读少
短信防骚扰中心：实时应用，目前存放150G，要兼顾读性能

## 二、方案

#### 1、ECS自建

集群有三个节点，例如4月份共花费3680.16元
* 172.20.60.41	4核16G
* 172.20.60.40	4核16G
* 172.20.60.39	4核16G

目前存储情况：100G  

特点：规划合理的话，自建成本从阿里云HBase低一点，但是该集群资源预留还是比较多。

问题：之前welab-message-antiha应用由于hbase故障出现次生产故障，分析完原因之后提了个tapd需求(https://www.tapd.cn/23553331/prong/stories/view/1123553331001021233)，一直处于规划中。

#### 2、CDH

能充分利用现有的CDH机器资源，所有离线型应用建议使用。实时型应用上次有讨论过不建议使用与离线型混布，如果是重要的应用就不迁入。

问题：上次CDH集群比较大量写hbase时出现集群不可用，目前HBase技术还需加强。

#### 3、阿里云HBase

留痕重构系统：目前500G，预计一年后800G,QPS设计为1W/S

阿里云Hbase成本：2master(2核4G)+2个core(4核16G+1000G高效云盘)=2\*235+2\*(677+350)=2524元/月  
ECS服务器自建Hbase成本：2\*179+2\*(510+350)=2078元/月  
两者相差不了太多，自建还需要考虑到运维成本。

短信防骚扰中心数据：
阿里云Hbase成本：2master(4核16G)+3个core(4核16G+800G高效云盘)=2\*658+3\*(658+350*0.8)=4130元/月 ，master节点大一点将来扩容会比较方便

## 三、计划

留痕重构系统和短信防骚扰中心将会共用Hbase。留痕重构系统基本没有QPS，数据量较大。短信防骚扰中心QPS大概为2W，数据量较小。二者基本成互补关系。
为了合理使用资源计划master节点使用2台4核16G，core节点先申请3台4核16G+1000G高效云盘的core节点，后续再看情况增加。

成本为:2\*658+3\*(658+350)=4340元/月